---
title: "analyses"
author: "Misha Leong"
date: "May 23, 2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Loading files

Get all the libraries in and the master files
```{r load it up}
library(tidyverse)
library(vegan)

# 2016, 2017, 2018 data (mix of some research grade and needs id)
all <- read.csv(("all_master.csv"))
nlcd_legend <- read.csv("nlcd_legend.csv")

```

## Filter

Basics is to get down to research grade, geocoordinates not obscured.  From there, can then look at certain taxa and certain years.

```{r filter}
all_basic <- all %>%
  filter(quality_grade == "research") %>%
  filter(coordinates_obscured == "false") %>%
  filter(hometown != "nashville") %>%
  left_join(nlcd_legend, by="NLCD_layer") 
```

```{r how many obs}
all_basic %>%
  group_by (hometown) %>%
  summarise (num_obs = n()) %>%
  arrange(desc(num_obs))
```
Because Nashville has so few observations, I'm going to exclude it from the analysis moving forward and just have 14 cities

Tested for this, but it's no longer something I'm going to worry about after talking with Rebecca and Alison.  Seems to be all over the place or not measured at all.  It's the self-reported error, but the actual error is likely way way less so don't really need to be too concerned about. NEVERMIND. I realized the REAL problem is that I was looking at frequency of unique values rather than a true frequency histogram.  I can probably safely cut out the over 30s, but then Minneapolis and Miami drop to below 1000 observations each.
```{r positional accuracy}
# wtf is going on here
hist(all$positional_accuracy, xlim=c(0,1000), breaks=500000)
hist(unique(all$positioning_device))
```

## Any interesting patterns with the different NLCD layers?
In 2018, new species discovery overall starts to flatten out.  There is always a higher proportion of new species to observations for natural over the developed land use types too.

```{r general glimps}
#how many species are there per layer? generic run through
all_basic%>%
  filter(taxon_class_name %in% c("Amphibia", "Arachnida", "Aves", "Gastropoda", "Insecta", "Mammalia", "Reptilia")) %>%
  group_by(nlcd_type) %>%
  group_by (nlcd_group) %>%
  summarise (num_cities = n_distinct(hometown), num_class = n_distinct(taxon_class_name), num_species = n_distinct(scientific_name), num_obs = n(), ratio = num_species / num_obs)

#2016
all_basic%>%
  filter(taxon_class_name %in% c("Amphibia", "Arachnida", "Aves", "Gastropoda", "Insecta", "Mammalia", "Reptilia")) %>%
  filter(year == 2016) %>%
  group_by(nlcd_type) %>%
  group_by (nlcd_group) %>%
  summarise (num_cities = n_distinct(hometown), num_class = n_distinct(taxon_class_name), num_species = n_distinct(scientific_name), num_obs = n(), ratio = num_species / num_obs)

#2017
all_basic%>%
  filter(taxon_class_name %in% c("Amphibia", "Arachnida", "Aves", "Gastropoda", "Insecta", "Mammalia", "Reptilia")) %>%
  filter(year == 2017) %>%
  group_by(nlcd_type) %>%
  group_by (nlcd_group) %>%
  summarise (num_cities = n_distinct(hometown), num_class = n_distinct(taxon_class_name), num_species = n_distinct(scientific_name), num_obs = n(), ratio = num_species / num_obs)

#2018
all_basic%>%
  filter(taxon_class_name %in% c("Amphibia", "Arachnida", "Aves", "Gastropoda", "Insecta", "Mammalia", "Reptilia")) %>%
  filter(year == 2018) %>%
  group_by(nlcd_type) %>%
  group_by (nlcd_group) %>%
  summarise (num_cities = n_distinct(hometown), num_class = n_distinct(taxon_class_name), num_species = n_distinct(scientific_name), num_obs = n(), ratio = num_species / num_obs)
```

## Species accumulation curves
Let's visualize what I was getting at in the above glimpse.  Do different land use types seem to be approching their maximun species? Meh all seem about the same.

```{r}
library(vegan)

plot_rarefaction <- function (nlcd_group_type) {
  comm_landuse<- all_wfreq %>%
    filter(nlcd_group == nlcd_group_type) %>%
    filter(freq=="common") %>%
    unite(long_name, taxon_class_name, taxon_order_name, taxon_family_name, scientific_name, sep = ".", remove = FALSE) %>%
    group_by(user_login, long_name) %>%
    summarise(obs = n()) %>%
    spread(long_name, obs, fill = 0) %>%
    as.data.frame()

  #names <- paste(comm_landuse$hometown, comm_landuse$nlcd_group, sep = ".")
  #rownames(comm_landuse) <- user_login
  comm_landuse[,1:2] <- NULL
  
  curve <- specaccum (comm_landuse, method = "rarefaction")
  plot(curve, ci.type = "line", ci.col = "lightblue", main = nlcd_group_type)
}

plot_rarefaction("natural")
plot_rarefaction("developed_open_low")
plot_rarefaction("developed_medium_high")

```

## Common versus Rare species

One way to divide up "common" (observed at least 15 times) and "rare" (only observed 2 or fewer) species. Common species can be found in relatively equal proportions between natural and developed land.  However, rare species are much more frequently observed in natural areas.

```{r who is common who is rare}
common <- all_basic %>%
  #filter(taxon_class_name %in% c("Amphibia", "Arachnida", "Aves", "Gastropoda", "Insecta", "Mammalia", "Reptilia")) %>%
  group_by(scientific_name) %>%
  summarise(count = n())  %>%
  filter(count>14) %>%
  arrange(desc(count)) %>%
  mutate(freq="common")

rare <- all_basic %>%
  #filter(taxon_class_name %in% c("Amphibia", "Arachnida", "Aves", "Gastropoda", "Insecta", "Mammalia", "Reptilia")) %>%
  group_by(scientific_name) %>%
  summarise(count = n())  %>%
  filter(count<3) %>%
  arrange(desc(count)) %>%
  mutate(freq="rare")

frequency_status <- rbind(common, rare)

all_wfreq <- all_basic%>% 
  #filter(taxon_class_name %in% c("Amphibia", "Arachnida", "Aves", "Gastropoda", "Insecta", "Mammalia", "Reptilia")) %>%
  filter(year==2018) %>%
  left_join(frequency_status, by = "scientific_name")

all_wfreq %>%
  filter(freq=="common") %>%
  group_by(nlcd_group) %>%
  summarise(rare_count = n_distinct(scientific_name)) %>%
  mutate(freq = paste0(round(100 * (rare_count / sum(rare_count)), 0), "%")) %>%
  arrange(desc(rare_count))

all_wfreq %>%
  filter(freq=="rare") %>%
  group_by(nlcd_group) %>%
  summarise(rare_count = n_distinct(scientific_name)) %>%
  mutate(freq = paste0(round(100 * (rare_count / sum(rare_count)), 0), "%")) %>%
  arrange(desc(rare_count))

```


## Community composition
Creating a community composition matrix (all_matrix) and associated environmental variables (all_env) based off of the Dune dataset.  Can alter first chunk based on what taxa am interested in exploring.

Creating a community matrix with NLCD groupings of Natural, Low Development, High Development
```{r}
all_taxa<- all_wfreq %>%
    filter(nlcd_group %in% c("natural", "developed_open_low", "developed_medium_high")) %>%
    filter(freq == "common") %>% 
    unite(long_name, taxon_class_name, taxon_order_name, taxon_family_name, scientific_name, sep = ".", remove = FALSE) %>%
    group_by(hometown, nlcd_group, long_name) %>%
    summarise(obs = n()) %>%
    spread(long_name, obs, fill = 0) %>%
    as.data.frame()
names <- paste(all_taxa$hometown, all_taxa$nlcd_group, sep = ".")
rownames(all_taxa) <- names
all_taxa[,1:2] <- NULL
landcover <- rep(c("developed_medium_high", "developed_open_low", "natural"), times = 14)
cities <-rownames(all_taxa)
all_taxa_env <- cities %>%
  as.data.frame.character() %>%
  separate(col = 1, into = c("hometown", "landcover_group"), extra = "merge")

## BIRDS
all_birds<- all_wfreq %>%
    filter(nlcd_group %in% c("natural", "developed_open_low", "developed_medium_high")) %>%
    filter(taxon_class_name == "Aves") %>%
    filter(freq == "common") %>% 
    unite(long_name, taxon_class_name, taxon_order_name, taxon_family_name, scientific_name, sep = ".", remove = FALSE) %>%
    group_by(hometown, nlcd_group, long_name) %>%
    summarise(obs = n()) %>%
    spread(long_name, obs, fill = 0) %>%
    as.data.frame()
names <- paste(all_birds$hometown, all_birds$nlcd_group, sep = ".")
rownames(all_birds) <- names
all_birds[,1:2] <- NULL
landcover <- rep(c("developed_medium_high", "developed_open_low", "natural"), times = 14)
cities <-rownames(all_taxa)
all_birds_env <- cities %>%
  as.data.frame.character() %>%
  separate(col = 1, into = c("hometown", "landcover_group"), extra = "merge")

## PLANTS
all_plants<- all_wfreq %>%
    filter(nlcd_group %in% c("natural", "developed_open_low", "developed_medium_high")) %>%
    filter(iconic_taxon_name == "Plantae") %>%
    filter(freq == "common") %>% 
    unite(long_name, taxon_class_name, taxon_order_name, taxon_family_name, scientific_name, sep = ".", remove = FALSE) %>%
    group_by(hometown, nlcd_group, long_name) %>%
    summarise(obs = n()) %>%
    spread(long_name, obs, fill = 0) %>%
    as.data.frame()
names <- paste(all_plants$hometown, all_plants$nlcd_group, sep = ".")
rownames(all_plants) <- names
all_plants[,1:2] <- NULL
landcover <- rep(c("developed_medium_high", "developed_open_low", "natural"), times = 14)
cities <-rownames(all_taxa)
all_plants_env <- cities %>%
  as.data.frame.character() %>%
  separate(col = 1, into = c("hometown", "landcover_group"), extra = "merge")

## nonbird animals
all_nonbirds<- all_wfreq %>%
    filter(nlcd_group %in% c("natural", "developed_open_low", "developed_medium_high")) %>%
    filter(taxon_class_name %in% c("Arachnida", "Gastropoda", "Insecta", "Amphibia", "Reptilia", "Mammalia")) %>% 
    filter(freq == "common") %>% 
    unite(long_name, taxon_class_name, taxon_order_name, taxon_family_name, scientific_name, sep = ".", remove = FALSE) %>%
    group_by(hometown, nlcd_group, long_name) %>%
    summarise(obs = n()) %>%
    spread(long_name, obs, fill = 0) %>%
    as.data.frame()
names <- paste(all_nonbirds$hometown, all_nonbirds$nlcd_group, sep = ".")
rownames(all_nonbirds) <- names
all_nonbirds[,1:2] <- NULL
landcover <- rep(c("developed_medium_high", "developed_open_low", "natural"), times = 14)
cities <-rownames(all_taxa)
all_nonbirds_env <- cities %>%
  as.data.frame.character() %>%
  separate(col = 1, into = c("hometown", "landcover_group"), extra = "merge")
```



```{r community composition plots and analyses}

plot_cc <- function (all_matrix, all_env, title) {
mod <- metaMDS(all_matrix)
plot(mod, display= "sites", type = "p", main=title)

## Hulls show treatment
#ordihull(mod, group=all_env$landcover, show="natural", col="green")
#ordihull(mod, group=all_env$landcover, show="developed_open_low", col="yellow")
#ordihull(mod, group=all_env$landcover, show="developed_medium_high", col="red")


## Hulls show cities
ordihull(mod, group=all_env$hometown, show="sanfrancisco", col="darkgoldenrod2")
ordihull(mod, group=all_env$hometown, show="losangeles", col="darkgoldenrod2")

ordihull(mod, group=all_env$hometown, show="austin", col="cyan3")
ordihull(mod, group=all_env$hometown, show="houston", col="cyan3")
ordihull(mod, group=all_env$hometown, show="dallas", col="cyan3")

ordihull(mod, group=all_env$hometown, show="boston", col="magenta")
ordihull(mod, group=all_env$hometown, show="washingtondc", col="magenta")
ordihull(mod, group=all_env$hometown, show="chicago", col="magenta")
ordihull(mod, group=all_env$hometown, show="newyork", col="magenta")

ordihull(mod, group=all_env$hometown, show="raleigh", col="green")

ordihull(mod, group=all_env$hometown, show="miami", col="pink")

ordihull(mod, group=all_env$hometown, show="minneapolis", col="purple")

ordihull(mod, group=all_env$hometown, show="seattle", col="blue")

ordihull(mod, group=all_env$hometown, show="saltlakecity", col="darkgreen")

#lc <- adonis(all_matrix ~ all_env$landcover_group, data = all_env, strata = all_env$hometown, permutations = 999)
#lc2 <- adonis(all_matrix ~ all_env$landcover_group, data = all_env, permutations = 999)
ht <- adonis(all_matrix ~ all_env$hometown, data = all_env, strata = all_env$landcover_group, permutations = 999)
#ht2 <- adonis(all_matrix ~ all_env$hometown, data = all_env, permutations = 999)
#lc
#lc2
ht
#ht2
}

plot_cc(all_taxa, all_taxa_env, "All taxa")
plot_cc(all_birds, all_birds_env, "Birds")
plot_cc(all_plants, all_plants_env, "Plants")
plot_cc(all_nonbirds, all_nonbirds_env, "Non-bird animals")

# Another technique
#plot(mod)
#with(all_env, ordiellipse(mod, landcover, kind = "ehull"))
#with(all_env, ordispider(mod, landcover, lty=3, col = "red"))

## Correct with strata
#perm <- how(nperm = 199)
#setBlocks(perm) <- with(all_env, landcover)

```

# MOST COMMON SPECIES LIST BY CITY AND LANDCOVER TYPE
This worked.  Everything was exported to .csv files, and for each taxon category, I combined them into workbooks in excel with three sheets called "ranks_taxa.xlsx"

```{r}
plants <- all_wfreq %>% filter(iconic_taxon_name == "Plantae") 
birds <- all_wfreq %>% filter(taxon_class_name == "Aves") 
nonbirds <- all_wfreq %>% filter(taxon_class_name %in% c("Arachnida", "Gastropoda", "Insecta", "Amphibia", "Reptilia", "Mammalia"))
arthropods <- all_wfreq %>% filter(taxon_class_name %in% c("Arachnida", "Insecta"))
herps <- all_wfreq %>% filter(taxon_class_name %in% c("Amphibia", "Reptilia"))
mammals <- all_wfreq %>% filter(taxon_class_name == "Mammalia")
gastropods <- all_wfreq %>% filter(taxon_class_name == "Gastropoda")

# Creates a ranked list of the most common species for each city
process_city <- function (hometown1, taxa2) {
    city_taxa <- taxa2 %>%
      filter(hometown == hometown1) %>%
      group_by(scientific_name) %>%
      summarise(count = n()) %>%
      arrange(desc(count)) %>%
      mutate(rank = rank(desc(count), ties.method="random")) %>%
      rename(!!hometown1 := scientific_name)
}

subset_data <- function(nlcd, taxa) {
  taxa2 <- taxa %>% filter(nlcd_group == nlcd)
  return(taxa2)
}

create_table <- function(nlcd, taxa) {
  
  taxa_total <- subset_data(nlcd,taxa) %>%
    group_by(scientific_name) %>%
    summarise(count = n())  %>%
    arrange(desc(count)) %>%
    mutate(rank = rank(desc(count), ties.method="random"))
  
  Austin <- process_city("austin", subset_data(nlcd,taxa))
  Boston  <- process_city("boston", subset_data(nlcd,taxa))
  Chicago  <- process_city("chicago", subset_data(nlcd,taxa))
  Dallas  <- process_city('dallas', subset_data(nlcd,taxa))
  Houston  <- process_city('houston', subset_data(nlcd,taxa))
  Los_Angeles  <- process_city('losangeles', subset_data(nlcd,taxa))
  Miami  <- process_city('miami', subset_data(nlcd,taxa))
  Minneapolis  <- process_city('minneapolis', subset_data(nlcd,taxa))
  New_York  <- process_city('newyork', subset_data(nlcd,taxa))
  Raleigh  <- process_city('raleigh', subset_data(nlcd,taxa))
  Salt_Lake_City  <- process_city('saltlakecity', subset_data(nlcd,taxa))
  San_Francisco  <- process_city('sanfrancisco', subset_data(nlcd,taxa))
  Seattle  <- process_city('seattle', subset_data(nlcd,taxa))
  Washington_DC <- process_city('washingtondc', subset_data(nlcd,taxa))

  big_table <- taxa_total %>%
    left_join(Austin, by="rank") %>%
    left_join(Boston, by="rank") %>%
    left_join(Chicago, by="rank") %>%
    full_join(Dallas, by="rank") %>%
    full_join(Houston, by="rank") %>%
    full_join(Los_Angeles, by="rank") %>%
    full_join(Miami, by="rank") %>%
    full_join(Minneapolis, by="rank") %>%
    full_join(New_York, by="rank") %>%
    full_join(Raleigh, by="rank") %>%
    full_join(Salt_Lake_City, by="rank") %>%
    full_join(San_Francisco, by="rank") %>%
    full_join(Seattle, by="rank") %>%
    full_join(Washington_DC, by="rank")%>%
    distinct()
}
  
write.csv(natural_birds <- create_table("natural", birds), "natural_birds.csv")
write.csv(urb_low_birds <- create_table("developed_open_low", birds), "urb_low_birds.csv")
write.csv(urb_high_birds <- create_table("developed_medium_high", birds), "urb_high_birds.csv")

write.csv(natural_plants <- create_table("natural", plants), "natural_plants.csv")
write.csv(urb_low_plants <- create_table("developed_open_low", plants), "urb_low_plants.csv")
write.csv(urb_high_plants <- create_table("developed_medium_high", plants), "urb_high_plants.csv")

write.csv(natural_arthropods <- create_table("natural", arthropods), "natural_arthropods.csv")
write.csv(urb_low_arthropods <- create_table("developed_open_low", arthropods), "urb_low_arthropods.csv")
write.csv(urb_high_arthropods <- create_table("developed_medium_high", arthropods), "urb_high_arthropods.csv")

write.csv(natural_herps <- create_table("natural", herps), "natural_herps.csv")
write.csv(urb_low_herps <- create_table("developed_open_low", herps), "urb_low_herps.csv")
write.csv(urb_high_herps <- create_table("developed_medium_high", herps), "urb_high_herps.csv")

write.csv(natural_mammals <- create_table("natural", mammals), "natural_mammals.csv")
write.csv(urb_low_mammals <- create_table("developed_open_low", mammals), "urb_low_mammals.csv")
write.csv(urb_high_mammals <- create_table("developed_medium_high", mammals), "urb_high_mammals.csv")

write.csv(natural_gastropods <- create_table("natural", gastropods), "natural_gastropods.csv")
write.csv(urb_low_gastropods <- create_table("developed_open_low", gastropods), "urb_low_gastropods.csv")
write.csv(urb_high_gastropods <- create_table("developed_medium_high", gastropods), "urb_high_gastropods.csv")

```

# CREATE OVER/UNDER REPRESENTATION TABLE
Create the total list for each landcover type.
Join these together.
Create a column that is the sum of the three landcover types.
Calculate the ratio for each landcover type divided by the sum.
Does not need to be broken up by taxa.
But sort it by sums.

```{r overunder representation tables}
plants <- all_wfreq %>% filter(iconic_taxon_name == "Plantae") 
birds <- all_wfreq %>% filter(taxon_class_name == "Aves") 
nonbirds <- all_wfreq %>% filter(taxon_class_name %in% c("Arachnida", "Gastropoda", "Insecta", "Amphibia", "Reptilia", "Mammalia"))
arthropods <- all_wfreq %>% filter(taxon_class_name %in% c("Arachnida", "Insecta"))
herps <- all_wfreq %>% filter(taxon_class_name %in% c("Amphibia", "Reptilia"))
mammals <- all_wfreq %>% filter(taxon_class_name == "Mammalia")
gastropods <- all_wfreq %>% filter(taxon_class_name == "Gastropoda")

#change this line as needed
taxon_data <-arthropods
  
total <- taxon_data %>% 
  group_by(scientific_name) %>%
  summarise(count = n()) %>%
  filter(count>9) %>%
  arrange(desc(count)) %>%
  rename(total = count)

natural <- taxon_data %>% 
  filter(nlcd_group == "natural") %>%
  group_by(scientific_name) %>%
  summarise(count = n())  %>%
  arrange(desc(count)) %>%
  rename(natural = count)

urban_low <- taxon_data %>% 
  filter(nlcd_group == "developed_open_low") %>%
  group_by(scientific_name) %>%
  summarise(count = n())  %>%
  arrange(desc(count)) %>%
  rename(urban_low = count)

urban_high <- taxon_data %>% 
  filter(nlcd_group == "developed_medium_high") %>%
  group_by(scientific_name) %>%
  summarise(count = n())  %>%
  arrange(desc(count)) %>%
  rename(urban_high = count)

ou_table <- total %>%
  left_join(natural, by="scientific_name") %>%
  left_join(urban_low, by="scientific_name") %>%
  left_join(urban_high, by="scientific_name") %>%
  mutate(ratio_natural = natural/total) %>%
  mutate(ratio_urban_low = urban_low/total) %>%
  mutate(ratio_urban_high = urban_high/total) %>%
  arrange(desc(ratio_natural))

write.csv(ou_table, "ou_arthropods.csv")

sd_table <- c(
              0.33+sd(ou_table$ratio_natural, na.rm = TRUE), 
              0.33-sd(ou_table$ratio_natural, na.rm = TRUE),
              0.33+sd(ou_table$ratio_urban_low, na.rm = TRUE), 
              0.33-sd(ou_table$ratio_urban_low, na.rm = TRUE),
              0.33+sd(ou_table$ratio_urban_high, na.rm = TRUE),
              0.33-sd(ou_table$ratio_urban_high, na.rm = TRUE))
sd_table

```

Using above code to create a function to pull out some more interesting data
```{r}

#function ou
ou <- function (taxon_data) {
total <- taxon_data %>% 
  group_by(scientific_name) %>%
  summarise(count = n()) %>%
  filter(count>9) %>%
  arrange(desc(count)) %>%
  rename(total = count)

natural <- taxon_data %>% 
  filter(nlcd_group == "natural") %>%
  group_by(scientific_name) %>%
  summarise(count = n())  %>%
  arrange(desc(count)) %>%
  rename(natural = count)

urban_low <- taxon_data %>% 
  filter(nlcd_group == "developed_open_low") %>%
  group_by(scientific_name) %>%
  summarise(count = n())  %>%
  arrange(desc(count)) %>%
  rename(urban_low = count)

urban_high <- taxon_data %>% 
  filter(nlcd_group == "developed_medium_high") %>%
  group_by(scientific_name) %>%
  summarise(count = n())  %>%
  arrange(desc(count)) %>%
  rename(urban_high = count)

ou_table <- total %>%
  left_join(natural, by="scientific_name") %>%
  left_join(urban_low, by="scientific_name") %>%
  left_join(urban_high, by="scientific_name") %>%
  mutate(ratio_natural = natural/total) %>%
  mutate(ratio_urban_low = urban_low/total) %>%
  mutate(ratio_urban_high = urban_high/total) %>%
  mutate(ou_natural=if_else(ratio_natural>=(0.33+sd(ou_table$ratio_natural, na.rm = TRUE)), 1, 0)) %>%
  mutate(ou_urban_low=if_else(ratio_urban_low>=(0.33+sd(ou_table$ratio_urban_low, na.rm = TRUE)), 1, 0)) %>%
  mutate(ou_urban_high=if_else(ratio_urban_high>=(0.33+sd(ou_table$ratio_urban_high, na.rm = TRUE)), 1, 0)) 

ou_natural_table <- ou_table %>% filter (ou_natural > 0) %>% mutate(over = "natural")
ou_urban_low_table <- ou_table %>% filter (ou_urban_low > 0) %>% mutate(over = "urban_low")
ou_urban_high_table <- ou_table %>% filter (ou_urban_high > 0) %>% mutate(over = "urban_high")

ou_summary <- ou_natural_table %>%
  bind_rows(ou_urban_low_table) %>%
  bind_rows(ou_urban_high_table) %>%
  select(c("scientific_name", "total", "natural", "urban_low", "urban_high", "over"))

ou_summary
}

plants <- all_wfreq %>% filter(iconic_taxon_name == "Plantae") 
birds <- all_wfreq %>% filter(taxon_class_name == "Aves") 
nonbirds <- all_wfreq %>% filter(taxon_class_name %in% c("Arachnida", "Gastropoda", "Insecta", "Amphibia", "Reptilia", "Mammalia"))
arthropods <- all_wfreq %>% filter(taxon_class_name %in% c("Arachnida", "Insecta"))
herps <- all_wfreq %>% filter(taxon_class_name %in% c("Amphibia", "Reptilia"))
mammals <- all_wfreq %>% filter(taxon_class_name == "Mammalia")
gastropods <- all_wfreq %>% filter(taxon_class_name == "Gastropoda")

ou(plants)
ou(birds)
ou(nonbirds)
ou(arthropods)
ou(herps)
ou(mammals)
ou(gastropods)
```

